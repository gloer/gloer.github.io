


<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>LIL LIVE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.4.3/css/foundation-float.css">
    <style>
    
        body {
            max-width: 700px;
            padding: 0 1rem;
            margin: auto;
        }

        #kampinfo {
            background-color: darkgreen;
            color: white;
            font-weight: 500;
            display: grid;
            grid-auto-flow: column;
            justify-content: space-around;
            align-items: center;
            padding: 0.5rem;
            grid-gap: 0.5rem;
            margin-bottom: 1rem;
        }

        #knapper {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            grid-gap: 1rem;
        }

        #info {
            padding: 1rem;
            margin-top: 1rem;            
            display: grid;
            grid-auto-flow: column;
            justify-content: space-between;
        }

        #btnFb {
            background-color: rgb(66, 103, 178);
            color: white;
            font-family: Helvetica, Arial, sans-serif;            
            padding: 0.25rem;
            display: grid;
            grid-auto-flow: column;
            align-items: center;
            border-radius: 0.25rem;
            user-select: none;
            cursor: pointer;
        }

        #btnFb span:first-child {  
            display: inline-block;                      
            width: 2rem;
            height: 2rem;
        }
        #btnFb span {
            display: inline-block;
        }

        footer {
            border-top: 1px solid #ccc;
            padding-top: 1rem;
        }

        #secSisteHendelser {
            padding: 1rem;
            background-color: #ffffef;
            border: 1px solid #ddd;
        }

        .watch {
            display: grid;
            grid-auto-flow: column;
            align-items: center;
            grid-gap: 0.5rem;
            background-color: darkblue;
            padding: 2px 0.5rem;
            cursor: pointer;
            border-radius: 0.25rem;
        }

        .watch img {
            height: 1.5rem;
            filter: invert(1);
        }

        #watch1, #watch2, #watch3, #watch4 {
            display: none;
        }
        
    
    </style>
</head>
<body>

    <header>
        <section id="kampinfo">
            <div class="hjemmelag">...</div>    
            <div id="watch" class="watch">
                <img src="icons/watch.png">
                <span>Start 1. omg</span>
            </div> 
            <div id="watch2" class="watch">
                <img src="icons/watch.png">
                <span>Pause</span>
            </div>                 
            <div id="watch3" class="watch">
                <img src="icons/watch.png">
                <span>Start 2. omg</span>
            </div>                 
            <div id="watch4" class="watch">
                <img src="icons/watch.png">
                <span>Avslutt kamp</span>
            </div>                 
            <div class="bortelag">...</div>    
        </section>
    </header>
    

    <section id="nyKamp">

        <form id="startSkjema">
            <label for="inpHjemmelag">Hjemmelag: </label>
            <input type="text" id="inpHjemmelag" placeholder="Hjemmelag">

            <label for="inpBortelag">Bortelag: </label>
            <input type="text" id="inpBortelag" placeholder="Bortelag">

            <label for="taKampinfo">Kampinfo: </label>
            <input type="text" id="taKampinfo">
            

            <button class="button expanded" type="submit">Gjør klart til kamp</button>
        </form>

    </section>

    <main>
        <section>

            <form id="regHendelse">
                <input type="text" id="inpHendelse" placeholder="Hva skjedde">
                <button class="button success expanded" type="submit">Kommentar...</button>
            </form>

        </section>

        <section id="knapper">            
            <button class="button" id="btnHjemmeGoal">Mål til hjemmelaget</button>
            <img src="icons/goal-football.svg">
            <button class="button" id="btnBorteGoal">Mål til bortelaget</button>                    
            <button class="button warning" id="btnHjemmeCorner">Corner til hjemmelaget</button>
            <img src="icons/corner.svg">
            <button class="button warning" id="btnBorteCorner">Corner til bortelaget</button>                    
            <button class="button primary" id="btnHjemmeGult">Gult kort til hjemmelaget</button>
            <img src="icons/yellow.svg">
            <button class="button primary" id="btnBorteGult">Gult kort til bortelaget</button>    
            
        </section>

        <section id="secSisteHendelser">
            Her vises din siste oppdatering...
        </section>


        
    </main>

    <footer>

       <div id="btnFb">
            <span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" class="_1pbq" color="#ffffff"><path fill="#ffffff" fill-rule="evenodd" d="M8 14H3.667C2.733 13.9 2 13.167 2 12.233V3.667A1.65 1.65 0 0 1
                3.667 2h8.666A1.65 1.65 0 0 1 14 3.667v8.566c0 .934-.733
                1.667-1.667
                1.767H10v-3.967h1.3l.7-2.066h-2V6.933c0-.466.167-.9.867-.9H12v-1.8c.033
                0-.933-.266-1.533-.266-1.267 0-2.434.7-2.467
                2.133v1.867H6v2.066h2V14z"></path>
            </svg></span>
            <span>Del kampen på Facebook</span>
       </div>

       <section id="info">
            <a href="" id="linkKamp" target="_blank">Følg kampen her</a>
            <button id="btnVisNyKamp" class="button alert">Opprett en ny kamp</button>
        </section>

    </footer>

    
    
    
    <script src="https://www.gstatic.com/firebasejs/5.5.5/firebase.js"></script>
    <script>
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyDX7_vsdMR6qbW807NMDafCM1m3RK_Gmrc",
            authDomain: "fire-my-store.firebaseapp.com",
            databaseURL: "https://fire-my-store.firebaseio.com",
            projectId: "fire-my-store",
            storageBucket: "fire-my-store.appspot.com",
            messagingSenderId: "377970988097"
        };
        firebase.initializeApp(config);
        // Done initializing

                
        const linkKamp = document.getElementById('linkKamp');
        const btnHjemmeGoal = document.getElementById('btnHjemmeGoal');
        const btnBorteGoal = document.getElementById('btnBorteGoal');
        const btnHjemmeCorner = document.getElementById('btnHjemmeCorner');
        const btnBorteCorner = document.getElementById('btnBorteCorner');
        const btnHjemmeGult = document.getElementById('btnHjemmeGult');
        const btnBorteGult = document.getElementById('btnBorteGult');
        const regHendelse = document.getElementById('regHendelse');
        const inpHendelse = document.getElementById('inpHendelse');
        const nyKamp = document.getElementById('nyKamp');
        const btnVisNyKamp = document.getElementById('btnVisNyKamp');
        const btnFb = document.getElementById("btnFb");
        
        
        const taKampinfo = document.getElementById('taKampinfo');
        

        const startSkjema = document.getElementById('startSkjema');
        const inpHjemmelag = document.getElementById('inpHjemmelag');
        const inpBortelag = document.getElementById('inpBortelag');
        
        
        

        const db = firebase.database();
        const kamper = db.ref("kamper");
        
        let start = 0;
        let key = null;

        let kampen;
        let hendelser;

        let hjemmelag;
        let bortelag;

        if(localStorage.myGameID) {

            nyKamp.style.display = "none";

            kampen = kamper.child(localStorage.myGameID);            
            hendelser = kampen.child("hendelser");
            key = localStorage.myGameID;


            kampen.on("value", snap => {
                const data = snap.val();
                console.log("DATA: " + data.hjemmelag);
                hjemmelag = data.hjemmelag;
                bortelag = data.bortelag;
                document.querySelector("#kampinfo .hjemmelag").innerText = data.hjemmelag;
                document.querySelector("#kampinfo .bortelag").innerText = data.bortelag;                
                btnHjemmeGoal.innerText = "Mål til " + hjemmelag;
                btnBorteGoal.innerText = "Mål til " + bortelag;
                btnHjemmeCorner.innerText = "Corner til " + hjemmelag;
                btnBorteCorner.innerText = "Corner til " + bortelag;
                btnHjemmeGult.innerText = "Gult kort til " + hjemmelag;
                btnBorteGult.innerText = "Gult kort til " + bortelag;
                linkKamp.href = "viserkamp.html?id=" + snap.key;
                document.querySelector("title").innerHTML = hjemmelag + " - " + bortelag;
                
                
            });
        }

        startSkjema.onsubmit = (evt) => {

            evt.preventDefault();

            nyKamp.style.display = "none";
            document.querySelector("header").style.display = "block";
            document.querySelector("main").style.display = "block";
            document.querySelector("footer").style.display = "block";
            kamper.push({
                start_tid: 0, //firebase.database.ServerValue.TIMESTAMP,
                hjemmelag: inpHjemmelag.value,
                bortelag: inpBortelag.value,
                hjemmegoal: 0,
                bortegoal: 0,
                status: "ikke_startet"
            }).then(
                snap => { 
                    key = snap.key; 
                    linkKamp.href="viserkamp.html?id=" + snap.key; 
                    linkKamp.style.display = "inline-block";                    
                    btnHjemmeGoal.innerText = "Mål til " + inpHjemmelag.value;
                    btnBorteGoal.innerText = "Mål til " + inpBortelag.value;
                    btnHjemmeCorner.innerText = "Corner til " + inpHjemmelag.value;
                    btnBorteCorner.innerText = "Corner til " + inpBortelag.value;
                    btnHjemmeGult.innerText = "Gult kort til " + inpHjemmelag.value;
                    btnBorteGult.innerText = "Gult kort til " + inpBortelag.value;
                    document.querySelector("#kampinfo .hjemmelag").innerText = inpHjemmelag.value;
                    document.querySelector("#kampinfo .bortelag").innerText = inpBortelag.value;

                    hjemmelag = inpHjemmelag.value;
                    bortelag = inpBortelag.value;
                    localStorage.myGameID = snap.key;
                    document.querySelector("title").innerHTML = hjemmelag + " - " + bortelag;

                    kampen = kamper.child(key);
                    hendelser = kampen.child("hendelser");

                    hendelser.on("child_added", (snap) => {
                        const data = snap.val();
                        document.querySelector("#secSisteHendelser").innerHTML = data.tekst;
                    });

                    hendelser.push({
                        type: "startcomment",
                        tekst: taKampinfo.value,
                        tidspunkt: 0
                    });

                    
                }
            );
            

        }

        btnFb.onclick = () => {
            console.log(key);
            const url = "http://gloer.github.io/firebase/vglive/viserkamp.html?id=" + key;
            window.open("https://www.facebook.com/sharer/sharer.php?u=" + url + "&t="+document.title, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600');return false; 
            
        }        

        btnVisNyKamp.onclick = () => {
            nyKamp.style.display = "block";
            document.querySelector("header").style.display = "none";
            document.querySelector("main").style.display = "none";
            document.querySelector("footer").style.display = "none";
        }

        btnHjemmeGoal.onclick = () => {
            kampen = kamper.child(key);
            hendelser = kampen.child("hendelser");
            let ekstra = "";
            if(inpHendelse.value != "") {
                ekstra = "<span>" + inpHendelse.value + "</span>";
            }

            hendelser.push({
                type: "goal",
                goaler: "home",
                tekst: "<div>Mål til " + hjemmelag + "!</div> " + ekstra,
                tidspunkt: firebase.database.ServerValue.TIMESTAMP
            });

            inpHendelse.value = "";
            
        }

        btnHjemmeGult.onclick = () => {
            kampen = kamper.child(key);
            hendelser = kampen.child("hendelser");

            let ekstra = "";
            if(inpHendelse.value != "") {
                ekstra = "<span>" + inpHendelse.value + "</span>";
            }

            hendelser.push({
                type: "yellowcard",
                goaler: "home",
                tekst: "<div>Gult kort til " + hjemmelag + "!</div> " + ekstra,
                tidspunkt: firebase.database.ServerValue.TIMESTAMP
            });

            inpHendelse.value = "";
            
        }

        btnBorteGult.onclick = () => {
            kampen = kamper.child(key);
            hendelser = kampen.child("hendelser");

            let ekstra = "";
            if(inpHendelse.value != "") {
                ekstra = "<span>" + inpHendelse.value + "</span>";
            }

            hendelser.push({
                type: "yellowcard",
                goaler: "away",
                tekst: "<div>Gult kort til " + bortelag + "!</div> " + ekstra,
                tidspunkt: firebase.database.ServerValue.TIMESTAMP
            });

            inpHendelse.value = "";
            
        }

        btnHjemmeCorner.onclick = () => {
            kampen = kamper.child(key);
            hendelser = kampen.child("hendelser");

            let ekstra = "";
            if(inpHendelse.value != "") {
                ekstra = "<span>" + inpHendelse.value + "</span>";
            }

            hendelser.push({
                type: "corner",
                goaler: "home",
                tekst: "<div>Corner til " + hjemmelag + "!</div> " + ekstra,
                tidspunkt: firebase.database.ServerValue.TIMESTAMP
            });
            
            inpHendelse.value = "";
        }

        btnBorteCorner.onclick = () => {
            kampen = kamper.child(key);
            hendelser = kampen.child("hendelser");

            let ekstra = "";
            if(inpHendelse.value != "") {
                ekstra = "<span>" + inpHendelse.value + "</span>";
            }

            hendelser.push({
                type: "corner",
                goaler: "away",
                tekst: "<div>Corner til " + bortelag + "!</div> " + ekstra,
                tidspunkt: firebase.database.ServerValue.TIMESTAMP
            });

            inpHendelse.value = "";
            
        }

        btnBorteGoal.onclick = () => {
            kampen = kamper.child(key);
            hendelser = kampen.child("hendelser");

            let ekstra = "";
            if(inpHendelse.value != "") {
                ekstra = "<span>" + inpHendelse.value + "</span>";
            }

            hendelser.push({
                type: "goal",
                goaler: "away",
                tekst: "<div>Mål til " + bortelag + "!</div> " + ekstra,
                tidspunkt: firebase.database.ServerValue.TIMESTAMP
            });

            inpHendelse.value = "";
            
        }

        regHendelse.onsubmit = (evt) => {
            evt.preventDefault();
            hendelser.push({
                type: "comment",
                tekst: inpHendelse.value,
                tidspunkt: firebase.database.ServerValue.TIMESTAMP
            });

            regHendelse.reset();
        }

        /*
        hendelser.on("child_added", (snap) => {
            const data = snap.val();
            document.querySelector("#secSisteHendelser").innerHTML = data.tekst;
        });
        */
    
        document.querySelector("#watch").onclick = () => {

            kampen.update({
                start_tid: firebase.database.ServerValue.TIMESTAMP
            });

            hendelser.push({                
                type: "comment",
                tekst: "Da er vi i gang",
                tidspunkt: firebase.database.ServerValue.TIMESTAMP
            });

            document.querySelector("#watch").style.display = "none";

            
        }

        kampen.on("child_changed", (snap) => {
            console.log("Something happened to the time");
        });

    </script>

</body>
</html>